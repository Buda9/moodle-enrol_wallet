{"version":3,"file":"overlyprice.min.js","sources":["../src/overlyprice.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * module overlyprice\n *\n * @module     enrol_wallet/overlyprice\n * @copyright  2024 Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nconst config = {attributes: true, childList: true, subtree: true};\n// Create an observer instance linked to the callback function\nlet observer;\nlet regionMain;\n\nconst callback = (mutationList) => {\n    for (const mutation of mutationList) {\n        if (mutation.type === \"childList\" && mutation.addedNodes.length > 0) {\n            for (let i = 0; i < mutation.addedNodes.length; i++) {\n                let node = mutation.addedNodes[i];\n                if (node instanceof HTMLElement) {\n                     searchAndInject(node);\n                }\n            }\n        }\n    }\n};\n\n/**\n * Search for enrol wallet icons and inject price and offers.\n * @param {HTMLElement} node\n */\nfunction searchAndInject(node = document) {\n    stopObserver();\n    let icons = node.querySelectorAll('[data-selector=enrol_wallet_icon]');\n\n    for (let i = 0; i < icons.length; i++) {\n        let instanceId = icons[i].getAttribute('data-instance-id');\n        let parent = icons[i].parentNode;\n        let id = 'enrol-wallet-cost-overlay-' + instanceId;\n        let exist = parent.querySelector('[data-identifier=' + id + ']');\n        if (exist) {\n            continue;\n        }\n\n        let cost = icons[i].getAttribute('data-cost');\n        let discount = icons[i].getAttribute('data-discount');\n        var titleElement = document.createElement('div');\n        titleElement.textContent = cost;\n        titleElement.dataIdentifier = id;\n        titleElement.title = icons[i].title;\n        titleElement.classList.add('enrol_wallet_walletcost');\n        parent.insertBefore(titleElement, icons[i]);\n        if (discount > 0) {\n            var discountLabel = document.createElement('div');\n            discountLabel.classList.add('enrol_wallet_offer');\n            discountLabel.innerHTML = '<div class=\"enrol-wallet-inner-offer\">' + discount + '%' + '</div>';\n            parent.parentNode.parentNode.appendChild(discountLabel);\n        }\n    }\n    startObserver();\n}\n\n/**\n * Start document mutation observation.\n */\nfunction startObserver() {\n    regionMain = document.getElementById(\"region-main\");\n    observer.observe(regionMain, config);\n}\n\n/**\n * Stop mutation observer.\n */\nfunction stopObserver() {\n    observer.disconnect();\n}\n\n/**\n * Init\n */\nexport const init = () => {\n    observer = new MutationObserver(callback);\n    setTimeout(function() {\n        searchAndInject();\n    }, 1000);\n};"],"names":["config","attributes","childList","subtree","observer","regionMain","callback","mutationList","mutation","type","addedNodes","length","i","node","HTMLElement","searchAndInject","document","stopObserver","icons","querySelectorAll","instanceId","getAttribute","parent","parentNode","id","querySelector","cost","discount","titleElement","createElement","textContent","dataIdentifier","title","classList","add","insertBefore","discountLabel","innerHTML","appendChild","startObserver","getElementById","observe","disconnect","MutationObserver","setTimeout"],"mappings":";;;;;;;;MAuBMA,OAAS,CAACC,YAAY,EAAMC,WAAW,EAAMC,SAAS,OAExDC,SACAC,iBAEEC,SAAYC,mBACT,MAAMC,YAAYD,gBACG,cAAlBC,SAASC,MAAwBD,SAASE,WAAWC,OAAS,MACzD,IAAIC,EAAI,EAAGA,EAAIJ,SAASE,WAAWC,OAAQC,IAAK,KAC7CC,KAAOL,SAASE,WAAWE,GAC3BC,gBAAgBC,aACfC,gBAAgBF,iBAW5BE,sBAAgBF,4DAAOG,SAC5BC,mBACIC,MAAQL,KAAKM,iBAAiB,yCAE7B,IAAIP,EAAI,EAAGA,EAAIM,MAAMP,OAAQC,IAAK,KAC/BQ,WAAaF,MAAMN,GAAGS,aAAa,oBACnCC,OAASJ,MAAMN,GAAGW,WAClBC,GAAK,6BAA+BJ,cAC5BE,OAAOG,cAAc,oBAAsBD,GAAK,kBAKxDE,KAAOR,MAAMN,GAAGS,aAAa,aAC7BM,SAAWT,MAAMN,GAAGS,aAAa,qBACjCO,aAAeZ,SAASa,cAAc,UAC1CD,aAAaE,YAAcJ,KAC3BE,aAAaG,eAAiBP,GAC9BI,aAAaI,MAAQd,MAAMN,GAAGoB,MAC9BJ,aAAaK,UAAUC,IAAI,2BAC3BZ,OAAOa,aAAaP,aAAcV,MAAMN,IACpCe,SAAW,EAAG,KACVS,cAAgBpB,SAASa,cAAc,OAC3CO,cAAcH,UAAUC,IAAI,sBAC5BE,cAAcC,UAAY,yCAA2CV,SAA3C,UAC1BL,OAAOC,WAAWA,WAAWe,YAAYF,gBAGjDG,yBAMKA,gBACLlC,WAAaW,SAASwB,eAAe,eACrCpC,SAASqC,QAAQpC,WAAYL,iBAMxBiB,eACLb,SAASsC,2BAMO,KAChBtC,SAAW,IAAIuC,iBAAiBrC,UAChCsC,YAAW,WACP7B,oBACD"}