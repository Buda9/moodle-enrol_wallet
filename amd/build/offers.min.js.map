{"version":3,"file":"offers.min.js","sources":["../src/offers.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Handle the offers form adding and deleting cases.\n *\n * @module     enrol_wallet/offers\n * @copyright  2024 2024, Mohammad Farouk <phun.for.physics@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport Ajax from 'core/ajax';\nlet container;\nlet courseid;\nlet selector;\nlet i = 0;\n\n/**\n * Add form fragment in the offers container.\n *\n * @param {string} type\n */\nfunction addFragment(type) {\n    let request = Ajax.call([{\n        methodname: \"enrol_wallet_get_offer_form_fragment\",\n        args: {\n            type: type,\n            increment: i,\n            course: courseid,\n        }\n    }]);\n    request[0].done((data) => {\n        container.innerHTML = container.innerHTML + data.data;\n        addDeleteButtonListener();\n        addSelectListener();\n    });\n}\n\n/**\n * Add listeners to delete buttons.\n */\nfunction addDeleteButtonListener() {\n    for (let j = 1; j <= i; j++) {\n        var deletebutton = document.querySelector('[name=offer_delete_' + j + ']');\n        if (!deletebutton) {\n            continue;\n        }\n        deletebutton.onclick = (event) => {\n            let number = event.target.getAttribute('data-action-delete');\n            let set = document.getElementById('offer_group_' + number);\n            set.remove();\n        };\n    }\n}\n\n/**\n * Add listener to select element to add new offers.\n */\nfunction addSelectListener() {\n    let select = document.getElementsByName('add_offer');\n    selector = select[0];\n    selector.onchange = () => {\n        i++;\n        addFragment(selector.value);\n        selector.value = '';\n    };\n}\n\n/**\n * Init\n * @param {number} cid the course id\n * @param {number} inc the increment\n */\nexport const init = (cid, inc = 0) => {\n    i = inc;\n    courseid = cid;\n    container = document.getElementById('id_wallet_offerscontainer');\n    if (i > 0) {\n        addDeleteButtonListener();\n    }\n    addSelectListener();\n};"],"names":["container","courseid","selector","i","addDeleteButtonListener","j","deletebutton","document","querySelector","onclick","event","number","target","getAttribute","getElementById","remove","addSelectListener","select","getElementsByName","onchange","type","value","Ajax","call","methodname","args","increment","course","done","data","innerHTML","cid","inc"],"mappings":";;;;;;;SAwBIA,UACAC,SACAC,8IACAC,EAAI,WA0BCC,8BACA,IAAIC,EAAI,EAAGA,GAAKF,EAAGE,IAAK,KACrBC,aAAeC,SAASC,cAAc,sBAAwBH,EAAI,KACjEC,eAGLA,aAAaG,QAAWC,YAChBC,OAASD,MAAME,OAAOC,aAAa,sBAC7BN,SAASO,eAAe,eAAiBH,QAC/CI,qBAQPC,wBACDC,OAASV,SAASW,kBAAkB,aACxChB,SAAWe,OAAO,GAClBf,SAASiB,SAAW,SAvCHC,KAwCbjB,IAxCaiB,KAyCDlB,SAASmB,MAxCXC,cAAKC,KAAK,CAAC,CACrBC,WAAY,uCACZC,KAAM,CACFL,KAAMA,KACNM,UAAWvB,EACXwB,OAAQ1B,aAGR,GAAG2B,MAAMC,OACb7B,UAAU8B,UAAY9B,UAAU8B,UAAYD,KAAKA,KACjDzB,0BACAY,uBA8BAd,SAASmB,MAAQ,kBASL,SAACU,SAAKC,2DAAM,EAC5B7B,EAAI6B,IACJ/B,SAAW8B,IACX/B,UAAYO,SAASO,eAAe,6BAChCX,EAAI,GACJC,0BAEJY"}