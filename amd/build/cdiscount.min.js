define("enrol_wallet/cdiscount",["exports","core/str"],(function(_exports,_str){
/**
   * Handling and calculate the values before and after discount in top up form and charger form.
   *
   * @module     enrol_wallet/cdiscount
   * @copyright  2024 Mohammad Farouk <phun.for.physics@gmail.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */
let form,valueInput,opInput,categoryInput,valueAfterInput;Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;let calculateValueHolder,chargingLabel="",rules=[];function calculateCharge(){for(var value=parseFloat(valueInput.value),op=opInput.value,cat=parseInt(categoryInput.value),maxDiscount=0,calculatedValue=value,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount,valueBefore=value+value*discount/(1-discount);valueBefore>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount,calculatedValue=valueBefore)}}"credit"==op?(calculateValueHolder.innerHTML=chargingLabel+Math.round(100*calculatedValue)/100,calculateValueHolder.style.display=""):(calculateValueHolder.innerHTML="",calculateValueHolder.style.display="none")}function proceedChargerForm(){calculateValueHolder=form.querySelector("[data-holder=calculated-value]"),opInput=form.querySelector("[name=op]"),valueInput.addEventListener("change",(()=>{calculateCharge()})),valueInput.addEventListener("keyup",(()=>{calculateCharge()})),opInput.addEventListener("change",(()=>{calculateCharge()})),categoryInput.addEventListener("change",(()=>{calculateCharge()})),(0,_str.get_string)("charging_value","enrol_wallet").done((data=>{chargingLabel=data}))}function calculateAfter(){for(var value=parseFloat(valueInput.value),cat=parseInt(categoryInput.value),maxDiscount=0,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount;value>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount)}}var calculatedValue=value-value*maxDiscount;valueAfterInput.value=calculatedValue}function calculateBefore(){for(var value=parseFloat(valueAfterInput.value),cat=parseInt(categoryInput.value),maxDiscount=0,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount;value/(1-discount)>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount)}}var realValueBefore=value/(1-maxDiscount);valueInput.value=realValueBefore}function proceedTopUpForm(){valueAfterInput=form.querySelector("[name=value-after]"),valueInput.onchange=calculateAfter,valueInput.onkeyup=calculateAfter,valueAfterInput.onchange=calculateBefore,valueAfterInput.onkeyup=calculateBefore}_exports.init=(formid,formType)=>{form=document.getElementById(formid),valueInput=form.querySelector("[name=value]"),categoryInput=form.querySelector("[name=category]");for(let i=1;;i++){let element=form.querySelector("[name=discount_rule_"+i+"]");if(!element)break;var object=JSON.parse(element.value);object.condition=parseFloat(object.condition),object.discount=parseFloat(object.discount),object.category=parseInt(object.category),rules.push(object)}"charge"==formType?proceedChargerForm():proceedTopUpForm()}}));

//# sourceMappingURL=cdiscount.min.js.map