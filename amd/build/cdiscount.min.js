define("enrol_wallet/cdiscount",["exports","core/str"],(function(_exports,_str){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0;_exports.init=(formid,formType)=>{let form,valueInput,opInput,categoryInput,valueAfterInput,calculateValueHolder,chargingLabel="",rules=[];function calculateCharge(){for(var value=parseFloat(valueInput.value),op=opInput.value,cat=parseInt(categoryInput.value),maxDiscount=0,calculatedValue=value,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount,valueBefore=value+value*discount/(1-discount);valueBefore>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount,calculatedValue=valueBefore)}}"credit"==op?(calculateValueHolder.innerHTML=chargingLabel+Math.round(100*calculatedValue)/100,calculateValueHolder.style.display=""):(calculateValueHolder.innerHTML="",calculateValueHolder.style.display="none")}function calculateAfter(){for(var value=parseFloat(valueInput.value),cat=parseInt(categoryInput.value),maxDiscount=0,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount;value>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount)}}var calculatedValue=value-value*maxDiscount;valueAfterInput.value=calculatedValue}function calculateBefore(){for(var value=parseFloat(valueAfterInput.value),cat=parseInt(categoryInput.value),maxDiscount=0,i=0;i<rules.length;i++){if(rules[i].category===cat){var discount=rules[i].discount;value/(1-discount)>=rules[i].condition&&discount>maxDiscount&&(maxDiscount=discount)}}var realValueBefore=value/(1-maxDiscount);valueInput.value=realValueBefore}function hideElse(){let container=form.getElementsByClassName("enrol-wallet-discounts-container"),cat=parseInt(categoryInput.value);for(let i=0;i<container.length;i++){let children=container[i].children;for(let x=0;x<children.length;x++){let catid=children[x].getAttribute("data-catid");children[x].style.display=catid==cat?"":"none"}}}form=document.getElementById(formid),valueInput=form.querySelector("[name=value]"),categoryInput=form.querySelector("[name=category]");for(let i=1;;i++){let element=form.querySelector("[name=discount_rule_"+i+"]");if(!element)break;var object=JSON.parse(element.value);object.condition=parseFloat(object.condition),object.discount=parseFloat(object.discount),object.category=parseInt(object.category),rules.push(object)}hideElse(),"charge"==formType?(calculateValueHolder=form.querySelector("[data-holder=calculated-value]"),opInput=form.querySelector("[name=op]"),valueInput.addEventListener("change",(()=>{calculateCharge()})),valueInput.addEventListener("keyup",(()=>{calculateCharge()})),opInput.addEventListener("change",(()=>{calculateCharge()})),categoryInput.addEventListener("change",(()=>{calculateCharge()})),(0,_str.get_string)("charging_value","enrol_wallet").done((data=>{chargingLabel=data}))):(valueAfterInput=form.querySelector("[name=value-after]"),valueInput.onchange=calculateAfter,valueInput.onkeyup=calculateAfter,valueAfterInput.onchange=calculateBefore,valueAfterInput.onkeyup=calculateBefore,categoryInput.addEventListener("change",(()=>{calculateAfter(),hideElse()})))}}));

//# sourceMappingURL=cdiscount.min.js.map